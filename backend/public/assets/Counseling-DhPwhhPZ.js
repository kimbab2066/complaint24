import{d as C,o as u,w,p as a,t as D,g as n,aJ as p,D as V,a2 as Z,e as y,f as S,F as W,a4 as Q,Z as ee,X as r,aD as te,bk as x,a1 as le,bq as ae,bn as M,aG as se}from"./index-CIvZqnG9.js";import{s as oe}from"./index-CaYQ582G.js";import{s as ne}from"./index-V3FZzHdg.js";import{s as ie}from"./index-Cq2nnSLM.js";import{s as re}from"./index-COnWdjRO.js";import{s as T}from"./index-CVVAIkGy.js";import"./index-D5j367Ho.js";import"./index-B8K14yKN.js";import"./index-CI70ECEq.js";import"./index-D2qeKuO0.js";import"./index-ntJNSm1c.js";import"./index-C8f_UxCN.js";import"./index-Q5f-HasL.js";import"./index-D3alGoI6.js";import"./index-2HQD3IZ5.js";import"./index-DrWbS65R.js";const ue={class:"w-full flex flex-column items-center"},ce={class:"line-height-3 w-full text-center"},me={class:"flex w-full gap-2"},de={__name:"ConfirmationDialog",props:{visible:{type:Boolean,default:!1},wardName:String,confirmationDateTime:String},emits:["close","goToHistory"],setup(c,{emit:b}){const i=b;return(m,t)=>(u(),C(p(Z),{visible:c.visible,onHide:t[2]||(t[2]=g=>i("close")),modal:"",header:"상담 신청 완료",style:{width:"450px"},breakpoints:{"960px":"75vw","641px":"100vw"}},{footer:w(()=>[a("div",me,[n(p(V),{label:"목록보기",onClick:t[0]||(t[0]=g=>i("goToHistory")),class:"p-button-text flex-1"}),n(p(V),{label:"닫기",onClick:t[1]||(t[1]=g=>i("close")),autofocus:"",class:"flex-1"})])]),default:w(()=>[a("div",ue,[t[3]||(t[3]=a("i",{class:"pi pi-check-circle text-green-500 text-5xl mb-4"},null,-1)),a("p",ce,D(c.wardName)+"님 "+D(c.confirmationDateTime)+" 상담이 예약되었습니다. ",1)])]),_:1},8,["visible"]))}},ve={key:0,class:"mb-4"},pe={class:"font-semibold text-lg mb-3"},fe={class:"flex flex-wrap gap-3"},O={__name:"TimeSlotList",props:{title:String,timeSlots:Array,selectedSlot:Object},emits:["select-time"],setup(c,{emit:b}){const i=b;function m(t){i("select-time",t)}return(t,g)=>c.timeSlots.length>0?(u(),y("div",ve,[a("div",pe,D(c.title),1),a("div",fe,[(u(!0),y(W,null,Q(c.timeSlots,f=>{var k;return u(),C(p(V),{key:f.start_time_stamp,label:f.time,outlined:((k=c.selectedSlot)==null?void 0:k.start_time_stamp)!==f.start_time_stamp,onClick:s=>m(f),style:{"min-width":"80px"}},null,8,["label","outlined","onClick"])}),128))])])):S("",!0)}},_e={class:"dashboard-layout"},ye={class:"main-content"},ge={class:"welcome-message"},we={key:0,class:"table-container flex justify-center items-center w-full"},be={class:"mb-4 text-center max-w-xl mx-auto"},he={class:"table-container"},xe={class:"flex justify-content-center"},Se={key:0,class:"mt-4 text-center text-gray-500"},De={key:1,class:"table-container"},ke={class:"mt-0"},$e={class:"text-center mb-4"},Te={class:"text-center mt-5"},Ce={key:2,class:"table-container"},qe={__name:"Counseling",setup(c){const b=se(),i=ee(),m=r([]),t=r(null),g=r(""),f=new Date;f.setHours(0,0,0,0);const k=r(f);new Date(f.getTime());const s=r(null),o=r(null),N=r(!1),L=r(!1),h=r(!0),B=r({});let $=new Set;const _=r([]),A=te();x(()=>{var e;return(e=A.user)==null?void 0:e.user_id}),x(()=>{var e;return(e=A.user)==null?void 0:e.name});function G(e){if(!e)return null;const l=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),v=String(e.getDate()).padStart(2,"0");return`${l}-${d}-${v}`}function H(e){return e?e.toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"}):""}function R(e){const l=G(e),d=B.value[l];console.log("선택된 날짜:",l),console.log("times:",d),s.value=e,o.value=null,_.value=d||[]}function F(e){o.value=e}async function U(){var l,d;if(!t.value){i.add({severity:"warn",summary:"신청 불가",detail:"먼저 상담받을 피보호자를 선택해주세요.",life:3e3});return}if(!s.value||!o.value){i.add({severity:"warn",summary:"신청 불가",detail:"날짜와 시간을 모두 선택해주세요.",life:3e3});return}const e=m.value.find(v=>v.ward_no===t.value);e&&(g.value=e.name),L.value=!0;try{const v={at_no:o.value.at_no,start_time_stamp:o.value.start_time_stamp,ward_no:t.value};await M.post("/api/user/schedule/reserve",v),N.value=!0}catch(v){i.add({severity:"error",summary:"예약 실패",detail:((d=(l=v.response)==null?void 0:l.data)==null?void 0:d.message)||"상담 신청 중 오류 발생",life:3e3})}finally{L.value=!1}}function I(){N.value=!1,s.value=null,o.value=null,_.value=[],K()}function q(){I(),b.push("/counseling-history")}const z=x(()=>_.value.filter(e=>parseInt(e.time.split(":")[0])<12)),E=x(()=>_.value.filter(e=>parseInt(e.time.split(":")[0])>=12)),J=x(()=>!s.value||!o.value?"":`${H(s.value)} ${o.value.time}시`);async function K(){h.value=!0,s.value=null,o.value=null,_.value=[];try{const e=await M.get("/api/user/schedule/available");B.value=e.data,$=new Set(Object.keys(e.data)),console.log("예약 가능 날짜:",$)}catch{i.add({severity:"error",summary:"오류",detail:"예약 가능한 시간을 불러올 수 없습니다."}),B.value={},$=new Set}finally{h.value=!1}}return le(async()=>{await K();try{const e=await ae.getMyWards();m.value=e.data.result,m.value.length===1&&(t.value=m.value[0].ward_no)}catch{i.add({severity:"error",summary:"오류",detail:"피보호자 목록을 불러오는 데 실패했습니다."})}}),(e,l)=>{const d=re,v=ie,P=ne,X=oe,Y=V;return u(),y(W,null,[a("div",_e,[a("div",ye,[l[4]||(l[4]=a("h1",{class:"page-title"},"상담 신청",-1)),a("p",ge," '예약 가능'한 날짜 중 하루를 선택하세요. (오늘: "+D(H(new Date))+") ",1),m.value.length>0?(u(),y("div",we,[n(p(T),{class:"w-full"},{content:w(()=>[a("div",be,[l[2]||(l[2]=a("label",{for:"ward-select",class:"block text-xl font-medium mb-2"}," 상담받을 피보호자 선택 ",-1)),n(d,{id:"ward-select",modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=j=>t.value=j),options:m.value,optionLabel:"name",optionValue:"ward_no",placeholder:"피보호자를 선택하세요",class:"w-full"},null,8,["modelValue","options"])])]),_:1})])):S("",!0),a("div",he,[n(p(T),null,{content:w(()=>[a("div",xe,[h.value?(u(),C(v,{key:0,style:{width:"50px",height:"50px"},strokeWidth:"8"})):(u(),C(P,{key:1,modelValue:s.value,"onUpdate:modelValue":l[1]||(l[1]=j=>s.value=j),inline:"",minDate:k.value,dateFormat:"yy-mm-dd",onDateSelect:R,class:"w-full"},null,8,["modelValue","minDate"]))]),!h.value&&p($).size===0?(u(),y("div",Se," 현재 예약 가능한 상담 일정이 없습니다. ")):S("",!0)]),_:1})]),s.value&&_.value.length>0?(u(),y("div",De,[n(p(T),null,{content:w(()=>[a("div",ke,[n(X),a("h6",$e,D(H(s.value)),1),n(O,{title:"오전","time-slots":z.value,"selected-slot":o.value,onSelectTime:F},null,8,["time-slots","selected-slot"]),n(O,{title:"오후","time-slots":E.value,"selected-slot":o.value,onSelectTime:F},null,8,["time-slots","selected-slot"]),a("div",Te,[n(Y,{label:"상담 신청",icon:"pi pi-check",loading:L.value,disabled:!o.value,onClick:U,class:"p-button-lg w-full md:w-auto"},null,8,["loading","disabled"])])])]),_:1})])):S("",!0),s.value&&_.value.length===0&&!h.value?(u(),y("div",Ce,[n(p(T),null,{content:w(()=>[...l[3]||(l[3]=[a("div",{class:"text-center text-gray-500 py-4"}," 선택하신 날짜에는 예약 가능한 시간이 없습니다. 다른 날짜를 선택해주세요. ",-1)])]),_:1})])):S("",!0)])]),n(de,{visible:N.value,wardName:g.value,confirmationDateTime:J.value,onClose:I,onGoToHistory:q},null,8,["visible","wardName","confirmationDateTime"])],64)}}};export{qe as default};
