import{ax as E,aD as F,X as p,bk as M,aE as q,ay as I,a1 as j,e as u,p as o,f as P,t as m,aK as T,j as d,aH as f,bm as x,q as b,F as w,a4 as z,a3 as A,bo as y,aG as R,o as i}from"./index-CIvZqnG9.js";const G={class:"flex flex-col items-center py-12 px-4 sm:px-6 lg:px-8 bg-gray-50 min-h-screen"},H={class:"w-full max-w-4xl"},K={class:"flex items-center justify-between mb-8"},W={class:"text-3xl font-bold text-gray-900 tracking-tight"},X={key:0,class:"px-3 py-1 rounded-full text-sm font-bold bg-indigo-100 text-indigo-800"},$={class:"bg-white rounded-2xl shadow-sm border border-gray-200 p-8 md:p-10"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-8"},O={class:"space-y-2"},Q={class:"space-y-2"},Y=["disabled"],Z=["value"],ee={class:"space-y-2"},te={class:"space-y-2"},oe={class:"space-y-2"},se={class:"space-y-2"},ae={class:"space-y-2"},ne=["readonly"],le={class:"space-y-2"},re=["disabled"],de={class:"space-y-2"},ue=["disabled"],ie={class:"col-span-1 md:col-span-2 space-y-2"},ce=["readonly"],fe={class:"flex justify-end space-x-3 pt-4 border-t border-gray-100 mt-4"},me=["disabled"],be=["disabled"],ye=["disabled"],ge={__name:"CounselingLogForm",setup(pe){const _=q(),v=R(),g=F(),c=p(!1),r=p(!1),k=p([]),l=p(!1),n=M(()=>!!_.query.consultNo),e=I({staff_id:"",staff_name:"",ward_no:"",ward_name:"",guardian_id:"",guardian_name:"",consult_datetime:"",disabled_level:"중증",consult_status:"진행중",content:"",survey_no:"",res_no:null});async function h(a){try{const t=await y.getSurveysByWard(a);k.value=t.data.surveys||[]}catch(t){console.error("조사지 조회 실패:",t)}}async function N(a){try{c.value=!0;const t=await y.getLogDetail(a),s=t.data.data||t.data;e.staff_id=s.staff_id,e.staff_name=s.staff_name,e.ward_no=s.ward_no,e.ward_name=s.ward_name,e.guardian_id=s.guardian_id,e.guardian_name=s.guardian_name,s.consult_datetime&&(e.consult_datetime=s.consult_datetime.split("T")[0]),e.disabled_level=s.disabled_level,e.consult_status=s.consult_status,e.content=s.content,e.survey_no=s.survey_no,e.res_no=s.res_no,e.ward_no&&await h(e.ward_no)}catch(t){console.error("상세 조회 실패:",t),alert("상담 기록을 불러올 수 없습니다."),v.back()}finally{c.value=!1}}j(async()=>{g.user&&g.user.name&&(e.staff_id=g.user.id,e.staff_name=g.user.name);const a=_.query;if(n.value)await N(a.consultNo);else if(a.wardNo&&(e.ward_no=a.wardNo,await h(a.wardNo)),a.resNo&&(e.res_no=a.resNo),a.wardName&&(e.ward_name=a.wardName),a.guardianId&&(e.guardian_id=a.guardianId),a.applicantName&&(e.guardian_name=a.applicantName),a.reservationDate)try{const t=a.reservationDate.split("T")[0];e.consult_datetime=t}catch{e.consult_datetime=a.reservationDate}});function V(){return e.staff_name?e.ward_name?e.consult_datetime?e.content.trim()?!0:alert("상담 내용을 입력해주세요."):alert("상담 일시를 입력해주세요."):alert("피보호자 정보가 없습니다."):alert("담당 직원 정보가 없습니다.")}async function L(){if(!c.value)try{c.value=!0,await y.saveDraft({...e}),alert("임시저장 되었습니다.")}catch(a){console.error("임시저장 실패:",a),alert("오류 발생")}finally{c.value=!1}}async function U(){if(!r.value&&V()&&confirm("상담 일지를 등록하시겠습니까?"))try{r.value=!0;const a={content:e.content,consult_datetime:e.consult_datetime,guardian_id:e.guardian_id||null,staff_id:e.staff_id,consult_status:e.consult_status,disabled_level:e.disabled_level,survey_no:e.survey_no?Number(e.survey_no):null,res_no:e.res_no?Number(e.res_no):null,ward_no:e.ward_no};await y.createLog(a),alert("등록 완료"),v.push("/reservations")}catch(a){console.error("등록 실패:",a),alert("등록 오류")}finally{r.value=!1}}function C(){l.value=!0}async function D(){if(!r.value&&V()&&confirm("상담 일지를 수정하시겠습니까?"))try{r.value=!0;const a=_.query.consultNo,t={content:e.content,consult_datetime:e.consult_datetime,guardian_id:e.guardian_id||null,staff_id:e.staff_id,consult_status:e.consult_status,disabled_level:e.disabled_level,survey_no:e.survey_no?Number(e.survey_no):null,res_no:e.res_no?Number(e.res_no):null,ward_no:e.ward_no};await y.updateLog(a,t),alert("수정 완료"),l.value=!1,await N(a)}catch(a){console.error("수정 실패:",a),alert("수정 오류")}finally{r.value=!1}}function B(){v.back()}function S(){alert("PDF 다운로드 기능")}return(a,t)=>(i(),u("div",G,[o("div",H,[o("div",K,[o("h1",W,m(n.value?l.value?"상담 일지 수정":"상담 일지 상세":"상담 일지 작성"),1),n.value?(i(),u("span",X,m(e.consult_status),1)):P("",!0)]),o("div",$,[o("form",{onSubmit:t[10]||(t[10]=T(s=>n.value?D():U(),["prevent"])),class:"space-y-8"},[o("div",J,[o("div",O,[t[11]||(t[11]=o("label",{class:"block text-sm font-bold text-gray-600"},"담당 직원명",-1)),d(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>e.staff_name=s),readonly:"",class:"block w-full rounded-md border border-gray-300 px-4 py-3 text-gray-700 bg-gray-100 cursor-not-allowed focus:border-gray-300 focus:ring-0 sm:text-sm outline-none"},null,512),[[f,e.staff_name]])]),o("div",Q,[t[13]||(t[13]=o("label",{class:"block text-sm font-bold text-gray-600"},"조사지 선택",-1)),d(o("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>e.survey_no=s),disabled:n.value&&!l.value,class:b([n.value&&!l.value?"bg-gray-100 cursor-not-allowed":"bg-white","block w-full rounded-md border border-gray-300 px-4 py-3 sm:text-sm"])},[t[12]||(t[12]=o("option",{value:"",disabled:""},"조사지를 선택하세요",-1)),(i(!0),u(w,null,z(k.value,s=>(i(),u("option",{key:s.survey_no,value:s.survey_no},m(s.business_name),9,Z))),128))],10,Y),[[x,e.survey_no]])]),o("div",ee,[t[14]||(t[14]=o("label",{class:"block text-sm font-bold text-gray-600"},"보호자명",-1)),d(o("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>e.guardian_name=s),readonly:"",class:"block w-full rounded-md border border-gray-300 px-4 py-3 text-gray-700 bg-gray-100 cursor-not-allowed focus:border-gray-300 focus:ring-0 sm:text-sm outline-none"},null,512),[[f,e.guardian_name]])]),o("div",te,[t[15]||(t[15]=o("label",{class:"block text-sm font-bold text-gray-600"},"보호자 ID",-1)),d(o("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=s=>e.guardian_id=s),readonly:"",class:"block w-full rounded-md border border-gray-300 px-4 py-3 text-gray-700 bg-gray-100 cursor-not-allowed focus:border-gray-300 focus:ring-0 sm:text-sm outline-none"},null,512),[[f,e.guardian_id]])]),o("div",oe,[t[16]||(t[16]=o("label",{class:"block text-sm font-bold text-gray-600"},"피보호자 ID",-1)),d(o("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>e.ward_no=s),readonly:"",class:"block w-full rounded-md border border-gray-300 px-4 py-3 text-gray-700 bg-gray-100 cursor-not-allowed focus:border-gray-300 focus:ring-0 sm:text-sm outline-none"},null,512),[[f,e.ward_no]])]),o("div",se,[t[17]||(t[17]=o("label",{class:"block text-sm font-bold text-gray-600"},"피보호자명",-1)),d(o("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>e.ward_name=s),readonly:"",class:"block w-full rounded-md border border-gray-300 px-4 py-3 text-gray-700 bg-gray-100 cursor-not-allowed focus:border-gray-300 focus:ring-0 sm:text-sm outline-none"},null,512),[[f,e.ward_name]])]),o("div",ae,[t[18]||(t[18]=o("label",{class:"block text-sm font-bold text-gray-600"},"상담 일시",-1)),d(o("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=s=>e.consult_datetime=s),readonly:n.value&&!l.value,class:b([n.value&&!l.value?"bg-gray-100 cursor-not-allowed":"bg-white","block w-full rounded-md border border-gray-300 px-4 py-3 text-gray-700 sm:text-sm outline-none"])},null,10,ne),[[f,e.consult_datetime]])]),o("div",le,[t[20]||(t[20]=o("label",{class:"block text-sm font-bold text-gray-600"},"장애 정도",-1)),d(o("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>e.disabled_level=s),disabled:n.value&&!l.value,class:b([n.value&&!l.value?"bg-gray-100 cursor-not-allowed":"bg-white","block w-full rounded-md border border-gray-300 px-4 py-3 sm:text-sm"])},[...t[19]||(t[19]=[o("option",{value:"중증"},"중증",-1),o("option",{value:"경증"},"경증",-1)])],10,re),[[x,e.disabled_level]])]),o("div",de,[t[22]||(t[22]=o("label",{class:"block text-sm font-bold text-gray-600"},"상담 상태",-1)),d(o("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>e.consult_status=s),disabled:n.value&&!l.value,class:b([n.value&&!l.value?"bg-gray-100 cursor-not-allowed":"bg-white","block w-full rounded-md border border-gray-300 px-4 py-3 sm:text-sm"])},[...t[21]||(t[21]=[o("option",{value:"진행중"},"진행중",-1),o("option",{value:"완료"},"완료",-1),o("option",{value:"취소"},"취소",-1)])],10,ue),[[x,e.consult_status]])]),o("div",ie,[t[23]||(t[23]=o("label",{class:"block text-sm font-bold text-gray-600"},"상담 내용 (특이사항)",-1)),d(o("textarea",{"onUpdate:modelValue":t[9]||(t[9]=s=>e.content=s),rows:"8",readonly:n.value&&!l.value,class:b([n.value&&!l.value?"bg-gray-100 cursor-not-allowed":"bg-white","block w-full rounded-md border border-gray-300 px-4 py-3 text-gray-900 sm:text-sm outline-none resize-none"]),placeholder:"상담 내용을 입력하세요."},null,10,ce),[[f,e.content]])])]),o("div",fe,[n.value?(i(),u(w,{key:0},[o("button",{type:"button",onClick:B,class:"px-6 py-2.5 bg-gray-400 text-white text-sm font-medium rounded-md hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-colors"}," 목록으로 "),l.value?(i(),u("button",{key:1,type:"button",onClick:D,disabled:r.value,class:"px-6 py-2.5 bg-[#16a34a] text-white text-sm font-medium rounded-md hover:bg-[#15803d] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors disabled:opacity-50"},m(r.value?"수정 중...":"수정 완료"),9,me)):(i(),u("button",{key:0,type:"button",onClick:C,class:"px-6 py-2.5 bg-[#546BE6] text-white text-sm font-medium rounded-md hover:bg-[#4356b8] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors"}," 수정 ")),o("button",{type:"button",onClick:S,class:"px-6 py-2.5 bg-[#546BE6] text-white text-sm font-medium rounded-md hover:bg-[#4356b8] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors flex items-center"},[...t[24]||(t[24]=[o("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),A(" PDF 다운로드 ",-1)])])],64)):(i(),u(w,{key:1},[o("button",{type:"button",onClick:L,disabled:c.value,class:"px-6 py-2.5 bg-gray-400 text-white text-sm font-medium rounded-md hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-colors disabled:opacity-50"},m(c.value?"저장 중...":"임시저장"),9,be),o("button",{type:"submit",disabled:r.value,class:"px-6 py-2.5 bg-[#546BE6] text-white text-sm font-medium rounded-md hover:bg-[#4356b8] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors disabled:opacity-50"},m(r.value?"등록 중...":"등록"),9,ye)],64))])],32)])])]))}},ve=E(ge,[["__scopeId","data-v-2eb5f666"]]);export{ve as default};
