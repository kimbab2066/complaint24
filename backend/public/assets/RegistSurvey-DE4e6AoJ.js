import{s as O}from"./index-D2nFSbvD.js";import{s as j}from"./index-vf1YAX2A.js";import{s as R}from"./index-CS-xok40.js";import{s as X}from"./index-DaQCVIMN.js";import{Z as J,a0 as Q,X as m,a1 as A,aF as U,as as q,aG as z,d as D,w as E,o as p,p as s,g as r,aJ as a,e as _,F as G,a4 as K,a3 as M,f as F,t as B,D as Z}from"./index-CIvZqnG9.js";import{s as H}from"./index-D3alGoI6.js";import{s as P}from"./index-Q5f-HasL.js";import"./index-DRZUHWhE.js";import"./index-B8K14yKN.js";import"./index-CI70ECEq.js";import"./index-2HQD3IZ5.js";import"./index-DrWbS65R.js";function W(){const y="tempSurveyDraft",V=z(),n=J(),I=Q(),w=m([]),u=m([]),f=m(""),S=m([{name:"상태1",code:0},{name:"상태2",code:1}]),k=m([{name:"서술형",code:1},{name:"O/X",code:2}]),L=m([{name:"긴급",code:"priority 1"},{name:"중점",code:"priority 2"},{name:"계획",code:"priority 3"}]),d=m({surveyName:"",businessItem:null,status:null}),c=m([]),C=async()=>{try{const e=(await U.get("/api/system/survey/notices/list")).data.notices||[];u.value=e,w.value=e.map(t=>({name:t.content,code:t.notice_no}))}catch(i){console.error("사업명 목록(Notice) 로드 실패:",i),n.add({severity:"error",summary:"로딩 실패",detail:"공지사항 목록을 불러오지 못했습니다.",life:5e3})}};function o(){return{id:Date.now(),content:"",responseType:null,required:!1,priority:null}}function b(){c.value.push(o())}function g(i){c.value.length>1?c.value.splice(i,1):console.warn("최소 1개의 질문이 필요합니다.")}const v=()=>{const i={basicInfo:d.value,questionList:c.value};try{localStorage.setItem(y,JSON.stringify(i)),console.log("--- [LocalStorage] 임시 저장 완료 ---"),n.add({severity:"success",summary:"저장 완료",detail:"현재 내용을 브라우저에 임시저장했습니다.",life:3e3})}catch(e){console.error("LocalStorage 저장 실패:",e),n.add({severity:"error",summary:"저장 실패",detail:"임시저장에 실패했습니다: "+e.message,life:5e3})}},h=()=>{I.require({message:`임시저장된 내용을 삭제하시겠습니까? 
현재 작성 내용은 모두 사라집니다.`,header:"삭제 확인",icon:"pi pi-exclamation-triangle",acceptLabel:"삭제",rejectLabel:"취소",accept:()=>{localStorage.removeItem(y),n.add({severity:"info",summary:"삭제 완료",detail:"임시저장된 내용이 삭제되었습니다.",life:3e3}),setTimeout(()=>{window.location.reload()},1e3)},reject:()=>{}})},T=async()=>{var e,t;if(!d.value.surveyName)return n.add({severity:"warn",summary:"입력 필요",detail:"조사지명을 입력하세요.",life:3e3});if(!d.value.businessItem)return n.add({severity:"warn",summary:"입력 필요",detail:"사업명을 선택하세요.",life:3e3});if(!d.value.status)return n.add({severity:"warn",summary:"입력 필요",detail:"상태를 선택하세요.",life:3e3});if(c.value.length===0||!c.value[0].content)return n.add({severity:"warn",summary:"입력 필요",detail:"질문을 1개 이상 입력하세요.",life:3e3});q(()=>d.value.businessItem,l=>{if(l&&l.code){const N=u.value.find($=>$.notice_no===l.code);N?f.value=N.content:f.value="관련 공지 내용을 찾을 수 없습니다."}else f.value=""},{immediate:!0});const i={...d.value,questionList:c.value,writer:"관리자"};try{const l=await U.post("/api/system/survey",i);n.add({severity:"success",summary:"등록 성공",detail:"조사지가 성공적으로 등록되었습니다!",life:3e3}),localStorage.removeItem(y),console.log("[LocalStorage] 최종 등록 완료. 임시 데이터를 삭제합니다."),V.push({name:"SurveyList"})}catch(l){console.error("등록 실패:",l),n.add({severity:"error",summary:"등록 실패",detail:"등록에 실패했습니다: "+(((t=(e=l.response)==null?void 0:e.data)==null?void 0:t.message)||l.message),life:5e3})}};function x(){c.value.length===0&&b()}return A(()=>{C();const i=localStorage.getItem(y);if(i)try{const e=JSON.parse(i);d.value=e.basicInfo,c.value=e.questionList,console.log("[LocalStorage] 임시저장된 데이터를 불러왔습니다."),n.add({severity:"info",summary:"데이터 복원",detail:"임시저장된 내용을 불러왔습니다.",life:3e3})}catch(e){console.error("임시저장 데이터 파싱 실패:",e),localStorage.removeItem(y),x()}else console.log("[LocalStorage] 저장된 데이터가 없습니다. 새 폼을 시작합니다."),x()}),{businessItems:w,statuses:S,responses:k,priorityList:L,basicInfo:d,questionList:c,initializeForm:x,addForm:b,removeQuestion:g,saveTemp:v,requestApproval:T,clearTemp:h,relatedNoticeContent:f}}const Y={class:"flex flex-col md:flex-row gap-8"},ee={class:"md:w-1/2 flex flex-col gap-8"},se={class:"card flex flex-col gap-6"},te={class:"flex flex-col gap-3"},oe={class:"flex flex-col gap-3"},le={class:"flex flex-col gap-3"},ae={class:"card flex flex-col gap-6"},re={class:"font-medium text-lg w-full flex justify-between items-center mb-3"},ne={class:"flex flex-col grow basis-0 gap-3"},ie=["for"],ce={class:"flex flex-wrap grow basis-0 gap-3 mt-4"},de=["for"],ue={key:0,class:"mt-4 p-3 border rounded-md bg-gray-50"},me={key:0,class:"flex items-center gap-4 mt-2"},pe={class:"flex items-center"},fe=["for"],ve={class:"flex items-center"},ye=["for"],ge={key:1,class:"mt-2"},_e={key:2,class:"mt-2 text-gray-500 text-sm"},be={class:"flex items-center gap-2"},xe=["for"],we={class:"flex flex-wrap grow basis-0 gap-3 mt-4"},he=["for"],Ve={class:"flex justify-end gap-2 mt-8"},Oe={__name:"RegistSurvey",setup(y){const{businessItems:V,statuses:n,responses:I,priorityList:w,basicInfo:u,questionList:f,addForm:S,removeQuestion:k,saveTemp:L,requestApproval:d,clearTemp:c}=W();return(C,o)=>{const b=P,g=H,v=Z,h=X,T=R,x=j,i=O;return p(),D(i,null,{default:E(()=>[s("div",Y,[s("div",ee,[s("div",se,[o[6]||(o[6]=s("div",{class:"font-semibold text-xl"},"조사지 기본 정보",-1)),s("div",te,[o[3]||(o[3]=s("label",{for:"name1"},"조사지명",-1)),r(b,{id:"name1",type:"text",modelValue:a(u).surveyName,"onUpdate:modelValue":o[0]||(o[0]=e=>a(u).surveyName=e)},null,8,["modelValue"])]),s("div",oe,[o[4]||(o[4]=s("label",{for:"businessName"},"사업명",-1)),r(g,{id:"businessName",modelValue:a(u).businessItem,"onUpdate:modelValue":o[1]||(o[1]=e=>a(u).businessItem=e),options:a(V),optionLabel:"name",placeholder:"미선택",class:"w-full"},null,8,["modelValue","options"])]),s("div",le,[o[5]||(o[5]=s("label",{for:"surveyStatus"},"상태",-1)),r(g,{id:"surveyStatus",modelValue:a(u).status,"onUpdate:modelValue":o[2]||(o[2]=e=>a(u).status=e),options:a(n),optionLabel:"name",placeholder:"미선택",class:"w-full"},null,8,["modelValue","options"])])]),s("div",ae,[o[8]||(o[8]=s("div",{class:"font-semibold text-xl"},"질문목록",-1)),(p(!0),_(G,null,K(a(f),(e,t)=>(p(),_("div",{key:e.id,class:"flex-col gap-4 p-4 border rounded-lg relative"},[s("span",re,[M(" 질문 "+B(t+1)+" ",1),a(f).length>1?(p(),D(v,{key:0,icon:"pi pi-times",severity:"danger",text:"",rounded:"",onClick:l=>a(k)(t)},null,8,["onClick"])):F("",!0)]),s("div",ne,[s("label",{for:"questionContent-"+t},"질문내용",8,ie),r(b,{modelValue:e.content,"onUpdate:modelValue":l=>e.content=l,id:"questionContent-"+t,type:"text",placeholder:"질문 내용을 입력하세요."},null,8,["modelValue","onUpdate:modelValue","id"])]),s("div",ce,[s("label",{for:"responseType-"+t},"답변유형",8,de),r(g,{id:"responseType-"+t,modelValue:e.responseType,"onUpdate:modelValue":l=>e.responseType=l,options:a(I),optionLabel:"name",placeholder:"유형을 선택하세요",class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue","options"]),e.responseType?(p(),_("div",ue,[o[7]||(o[7]=s("label",{class:"font-medium text-sm text-gray-600"},"답변 예시 (미리보기)",-1)),e.responseType.name==="O/X"?(p(),_("div",me,[s("div",pe,[r(h,{inputId:"preview-ox-o-"+t,name:"preview-ox-"+t,value:"O",disabled:""},null,8,["inputId","name"]),s("label",{for:"preview-ox-o-"+t,class:"ml-2 text-gray-700"},"O",8,fe)]),s("div",ve,[r(h,{inputId:"preview-ox-x-"+t,name:"preview-ox-"+t,value:"X",disabled:""},null,8,["inputId","name"]),s("label",{for:"preview-ox-x-"+t,class:"ml-2 text-gray-700"},"X",8,ye)])])):e.responseType.name==="서술형"?(p(),_("div",ge,[r(T,{id:"preview-text-"+t,rows:"3",class:"w-full",placeholder:"사용자가 답변을 입력하는 공간입니다.",disabled:""},null,8,["id"])])):(p(),_("div",_e," ("+B(e.responseType.name)+" 유형의 답변란이 표시됩니다) ",1))])):F("",!0),s("div",be,[r(x,{modelValue:e.required,"onUpdate:modelValue":l=>e.required=l,inputId:"essential-"+t,binary:!0,"true-Value":1,"false-Value":0},null,8,["modelValue","onUpdate:modelValue","inputId"]),s("label",{for:"essential-"+t},"필수 여부",8,xe)])]),s("div",we,[s("label",{for:"priority-"+t},"우선 순위",8,he),r(g,{id:"priority-"+t,modelValue:e.priority,"onUpdate:modelValue":l=>e.priority=l,options:a(w),optionLabel:"name",placeholder:"우선 순위를 선택하세요",class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue","options"])])]))),128)),r(v,{label:"질문 추가",icon:"pi pi-plus",severity:"info",onClick:a(S),outlined:""},null,8,["onClick"]),o[9]||(o[9]=s("div",{class:"flex justify-center mt-6"},null,-1)),s("div",Ve,[r(v,{label:"초기화 (임시저장 삭제)",icon:"pi pi-trash",severity:"danger",outlined:"",onClick:a(c)},null,8,["onClick"]),r(v,{label:"임시저장",icon:"pi pi-save",severity:"secondary",onClick:a(L)},null,8,["onClick"]),r(v,{label:"등록 요청",icon:"pi pi-send",severity:"info",onClick:a(d)},null,8,["onClick"])])])])])]),_:1})}}};export{Oe as default};
