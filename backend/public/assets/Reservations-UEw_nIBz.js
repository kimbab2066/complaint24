import{ax as E,e as n,f as D,o as l,p as e,a3 as w,t as i,X as r,bk as z,a1 as A,g as K,j as h,bm as U,aH as R,aI as O,F as $,a4 as P,aA as F,bl as V,aG as H}from"./index-CIvZqnG9.js";const q={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-opacity-50"},G={class:"bg-white rounded-lg shadow-xl w-full max-w-md transform transition-all"},W={class:"p-6"},X={key:0,class:"mt-2 text-sm text-gray-600"},J={key:1,class:"mt-4 text-sm text-red-600"},Q={class:"px-6 py-4 bg-gray-50 flex justify-end space-x-3"},Y=["disabled"],Z={__name:"ReservationCancelModal",props:{isOpen:{type:Boolean,default:!1},reservation:{type:Object,default:null},isCanceling:{type:Boolean,default:!1},error:{type:String,default:null}},emits:["close","confirm"],setup(u,{emit:_}){const d=_;function f(c){if(!c)return"날짜 정보 없음";try{return new Date(c).toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return c}}function m(){d("close")}function g(){d("confirm")}return(c,a)=>u.isOpen?(l(),n("div",q,[e("div",G,[a[4]||(a[4]=e("div",{class:"px-6 py-4 border-b"},[e("h3",{class:"text-lg font-medium leading-6 text-gray-900"},"예약 취소 확인")],-1)),e("div",W,[a[2]||(a[2]=e("p",{class:"text-sm text-gray-700"},"정말로 이 예약을 취소하시겠습니까?",-1)),u.reservation?(l(),n("div",X,[e("p",null,[a[0]||(a[0]=e("strong",null,"일시:",-1)),w(" "+i(f(u.reservation.start_time)),1)]),e("p",null,[a[1]||(a[1]=e("strong",null,"신청인:",-1)),w(" "+i(u.reservation.applicantName),1)])])):D("",!0),a[3]||(a[3]=e("p",{class:"mt-4 text-sm text-yellow-700 bg-yellow-50 p-3 rounded-md"}," 취소 시, 해당 시간은 '상담불가' 상태로 변경되며 신청자에게 알림이 전송됩니다. ",-1)),u.error?(l(),n("p",J,"취소 실패: "+i(u.error),1)):D("",!0)]),e("div",Q,[e("button",{type:"button",onClick:m,class:"px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," 닫기 "),e("button",{type:"button",onClick:g,disabled:u.isCanceling,class:"px-4 py-2 bg-red-600 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},i(u.isCanceling?"취소 중...":"예약 취소"),9,Y)])])])):D("",!0)}},ee=E(Z,[["__scopeId","data-v-5c908590"]]),te={class:"flex-1 overflow-y-auto p-8 bg-gray-100"},se={class:"bg-white p-6 rounded-lg shadow-sm mb-6"},oe={class:"flex flex-col md:flex-row md:items-end md:space-x-4 gap-4"},ae={class:"flex-none"},ne={class:"flex-1 min-w-0"},le={key:0,class:"flex space-x-2"},re={key:1},ie=["placeholder"],de={class:"flex-none"},ue=["disabled"],ce={class:"bg-white rounded-lg shadow-sm overflow-hidden"},pe={class:"overflow-x-auto"},fe={class:"min-w-full divide-y divide-gray-200"},me={class:"bg-white divide-y divide-gray-200"},ge={key:0},xe={key:1},ve={colspan:"6",class:"px-6 py-4 text-center text-sm text-red-600"},ye={key:2},be={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},we={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 truncate max-w-xs"},ke={class:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2"},Ne=["onClick"],Ce=["onClick"],De=["onClick"],Re={class:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6"},$e={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Te={class:"text-sm text-gray-700"},Me={class:"font-medium"},Be={__name:"Reservations",setup(u){const _=H(),d=r("date"),f=r(""),m=r(""),g=r(""),c=r([]),a=r(!1),b=r(null),k=r(!1),x=r(null),v=r(!1),p=r(null),L=z(()=>d.value==="applicant"?"보호자 이름을 입력하세요":d.value==="reason"?"사유를 입력하세요":"검색어를 입력하세요");function j(o){if(!o)return"날짜 정보 없음";try{return new Date(o).toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return o}}async function N(){a.value=!0,b.value=null;const o={searchType:d.value};d.value==="date"?(o.startDate=f.value||null,o.endDate=m.value||null):o.keyword=g.value;try{const t=await V.getReservations(o);c.value=t.data.map(s=>({...s,start_time:s.start_time,applicantName:s.applicantName,patientName:s.wardName,wardNo:s.wardNo,reason:s.reason,atNo:s.atNo,id:s.id,user_id:s.user_id}))}catch(t){console.error("예약 목록 조회 실패:",t),b.value=t}finally{a.value=!1}}function T(){N()}A(()=>{N()});function M(o){console.log("(Action) 기록 작성 페이지로 이동:"),console.log(`Available Time No (at_no): ${o.atNo}`),_.push({path:"/counseling-logform",query:{atNo:o.atNo,resNo:o.id,applicantName:o.applicantName,wardNo:o.wardNo,wardName:o.patientName,reservationDate:o.start_time,guardianId:o.user_id}})}function I(o){x.value=o,p.value=null,k.value=!0}function B(){k.value=!1,x.value=null,v.value=!1,p.value=null}async function S(){var s,y;if(!x.value||v.value)return;const t=x.value.atNo;if(!t){p.value="취소할 예약 ID(at_no)가 없습니다.";return}v.value=!0,p.value=null;try{await V.cancelReservationByStaff(t),console.log(`(DB) UPDATE available_time SET status = '상담불가' WHERE at_no = ${t};`),await N(),B()}catch(C){console.error("예약 취소 실패:",C),p.value=((y=(s=C.response)==null?void 0:s.data)==null?void 0:y.message)||C.message||"알 수 없는 오류 발생"}finally{v.value=!1}}return(o,t)=>(l(),n($,null,[e("div",te,[e("div",se,[e("div",oe,[e("div",ae,[t[5]||(t[5]=e("label",{for:"search-type",class:"block text-sm font-medium text-gray-700 mb-1"},"검색 조건",-1)),h(e("select",{id:"search-type","onUpdate:modelValue":t[0]||(t[0]=s=>d.value=s),class:"w-full md:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},[...t[4]||(t[4]=[e("option",{value:"date"},"상담일시",-1),e("option",{value:"applicant"},"보호자이름",-1),e("option",{value:"reason"},"사유",-1)])],512),[[U,d.value]])]),e("div",ne,[t[7]||(t[7]=e("label",{for:"search-value",class:"block text-sm font-medium text-gray-700 mb-1"},"검색 값",-1)),d.value==="date"?(l(),n("div",le,[h(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=s=>f.value=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[R,f.value]]),t[6]||(t[6]=e("span",{class:"flex items-center text-gray-500"},"~",-1)),h(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=s=>m.value=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[R,m.value]])])):(l(),n("div",re,[h(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=s=>g.value=s),placeholder:L.value,onKeyup:O(T,["enter"]),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"},null,40,ie),[[R,g.value]])]))]),e("div",de,[e("button",{onClick:T,disabled:a.value,class:"w-full md:w-auto px-6 py-2 bg-indigo-600 text-white rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50"},i(a.value?"검색 중...":"검색"),9,ue)])])]),e("div",ce,[e("div",pe,[e("table",fe,[t[10]||(t[10]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 상담 일시 "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 신청인(보호자) "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 피보호자 "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 요청 사유 "),e("th",{scope:"col",class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," 관리 ")])],-1)),e("tbody",me,[a.value?(l(),n("tr",ge,[...t[8]||(t[8]=[e("td",{colspan:"6",class:"px-6 py-4 text-center text-sm text-gray-500"}," 목록을 불러오는 중입니다... ",-1)])])):b.value?(l(),n("tr",xe,[e("td",ve," 목록을 불러오는데 실패했습니다: "+i(b.value.message),1)])):c.value.length===0?(l(),n("tr",ye,[...t[9]||(t[9]=[e("td",{colspan:"6",class:"px-6 py-4 text-center text-sm text-gray-500"}," 표시할 예약 내역이 없습니다. ",-1)])])):(l(!0),n($,{key:3},P(c.value,s=>(l(),n("tr",{key:s.id},[e("td",be,i(j(s.start_time)),1),e("td",he,i(s.applicantName),1),e("td",we,i(s.patientName),1),e("td",_e,i(s.reason),1),e("td",ke,[s.status==="상담완료"?(l(),n("button",{key:0,onClick:y=>M(s),class:"px-3 py-1 bg-green-500 text-white rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"}," 기록 보기 ",8,Ne)):(l(),n($,{key:1},[e("button",{onClick:y=>M(s),class:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," 기록 작성 ",8,Ce),e("button",{onClick:y=>I(s),class:"px-3 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," 예약 취소 ",8,De)],64))])]))),128))])])]),e("div",Re,[e("div",$e,[e("div",null,[e("p",Te,[t[11]||(t[11]=w(" 총 ",-1)),e("span",Me,i(c.value.length),1),t[12]||(t[12]=w(" 건 ",-1))])]),t[13]||(t[13]=F('<div data-v-99b47e74><nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination" data-v-99b47e74><a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" data-v-99b47e74><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-v-99b47e74><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" data-v-99b47e74></path></svg></a><a href="#" aria-current="page" class="z-10 bg-indigo-50 border-indigo-500 text-indigo-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium" data-v-99b47e74> 1 </a><a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 text-sm font-medium text-gray-500 hover:bg-gray-50" data-v-99b47e74><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-v-99b47e74><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" data-v-99b47e74></path></svg></a></nav></div>',1))])])])]),K(ee,{"is-open":k.value,reservation:x.value,"is-canceling":v.value,error:p.value,onConfirm:S,onClose:B},null,8,["is-open","reservation","is-canceling","error"])],64))}},Ee=E(Be,[["__scopeId","data-v-99b47e74"]]);export{Ee as default};
