import{s as z}from"./index-COnWdjRO.js";import{ax as G,aD as J,aE as H,X as d,a1 as K,aF as x,bk as E,e as p,f as w,g as n,aJ as a,w as v,d as C,p as l,D as N,aG as Y,o as u,t as D,a3 as Z,F,a4 as L,q as ee}from"./index-CIvZqnG9.js";import{s as I}from"./index-CVVAIkGy.js";import{s as R}from"./index-Q5f-HasL.js";import{s as W}from"./index-DaQCVIMN.js";import{s as h}from"./index-CS-xok40.js";import{s as le}from"./index-Cq2nnSLM.js";import"./index-D3alGoI6.js";import"./index-B8K14yKN.js";import"./index-CI70ECEq.js";import"./index-2HQD3IZ5.js";import"./index-DrWbS65R.js";const se={key:0,class:"flex justify-center items-center h-64"},ae={key:1},te={key:2,class:"flex flex-col gap-8"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},re={class:"flex flex-col gap-3"},ne={class:"flex flex-col gap-3"},ue={class:"flex flex-col gap-3"},ie={class:"flex flex-col gap-3"},de={class:"flex flex-col gap-6"},pe={class:"flex flex-col gap-3"},ve={class:"flex flex-col gap-3"},ce={class:"flex flex-col gap-3"},me={class:"text-lg font-bold text-gray-700 border-b pb-2"},fe=["for"],ye={key:1,class:"flex items-center gap-6"},xe={class:"flex items-center"},_e=["for"],we={class:"flex items-center"},be=["for"],ge={class:"flex flex-col gap-3"},Ve={class:"flex justify-end gap-2"},ke={__name:"UserInquiryDetail",setup(Ue){const T=J(),X=H(),j=Y(),b=X.params.id,i=d(null),y=d([]),q=d(!0),S=d(null),g=d(!1),m=d(null),V=d(""),k=d(""),U=d(""),$=d(null),B=d([]);K(async()=>{if(!b){S.value="유효하지 않은 접근입니다. ID가 없습니다.",q.value=!1;return}try{const t=await x.get(`/api/user/user-inquiries/${b}`);i.value=t.data.result,i.value.inquiry_writer=T.user.id,console.log("조회 해 온 조사지 상세정보:",i.value);const e=await x.get(`/api/user/user-inquiries/${b}/questions`);console.log("조사지의 질문 및 중요도 상세정보:",e.data.result);const r=await x.post("/api/user/survey-by-inquiry-content",{inquiryNo:b}),_=(await x.get("/api/user/surveys/create",{params:{guardianId:T.user.id,inquiryNo:b}})).data.result;_&&_.length>0?B.value=_:B.value=[{name:"조회 대상이 없습니다.",ward_no:null}];let s=new Map;r.data.result&&(g.value=!0,m.value=r.data.result,V.value=m.value.modify_reason||"",k.value=m.value.purpose||"",U.value=m.value.content||"",console.log("기존에 작성한 내용이 있습니다 (수정모드):",m.value),(await x.get(`/api/user/survey-results/${m.value.survey_no}`)).data.result.forEach(f=>{s.set(f.business_no,f.survey_answer)}),console.log("기존 답변 정보:",s)),y.value=e.data.result.map(c=>({id:c.question_no,text:c.question_content,answer:s.get(c.question_no)||"",response_type:c.response_type,is_required:c.is_required,priority:c.priority}))}catch(t){console.error("데이터를 불러오는 데 실패했습니다:",t),S.value="데이터를 불러오는 중 오류가 발생했습니다."}finally{q.value=!1}});const A=E(()=>{const t=y.value.some(r=>r.is_required===1&&(r.answer===null||r.answer.toString().trim()==="")),e=$.value===null;return g.value?t||V.value.trim()===""||e:t||e}),O=E(()=>!y.value||y.value.length===0?{}:y.value.reduce((t,e)=>{const r=e.priority||"기타";return t[r]||(t[r]=[]),t[r].push(e),t},{})),P=async()=>{try{const t=y.value.map(o=>({business_no:o.id,survey_answer:o.answer})),e={...i.value};e.writer=T.user.id,e.ward_no=$.value,e.purpose=k.value,e.content=U.value,e.status="접수";const r={inquiryDetail:e,answers:t};console.log("Payload to be sent:",r),await x.post("/api/user/user-inquiries/answer",r),alert("내용이 저장되었습니다.")}catch(t){console.error("저장에 실패했습니다:",t),alert("저장 중 오류가 발생했습니다.")}},Q=async()=>{if(!m.value){alert("오류: 수정할 설문 정보가 없습니다.");return}try{const e={answers:y.value.map(r=>({business_no:r.id,survey_answer:r.answer})),modificationReason:V.value,purpose:k.value,content:U.value};await x.put(`/api/user/survey-results/${m.value.survey_no}`,e),alert("내용이 수정되었습니다.")}catch(t){console.error("수정에 실패했습니다:",t),alert("수정 중 오류가 발생했습니다.")}},M=()=>{j.go(-1)};return(t,e)=>{const r=z;return u(),p("div",null,[q.value?(u(),p("div",se,[n(a(le))])):S.value?(u(),p("div",ae,[n(a(I),null,{title:v(()=>[...e[7]||(e[7]=[Z("오류",-1)])]),content:v(()=>[l("p",null,D(S.value),1),n(a(N),{label:"목록으로 돌아가기",onClick:M,class:"mt-4"})]),_:1})])):i.value?(u(),p("div",te,[n(a(I),null,{title:v(()=>[...e[8]||(e[8]=[l("div",{class:"font-semibold text-xl"},"조사지 기본 정보",-1)])]),content:v(()=>[l("div",oe,[l("div",re,[e[9]||(e[9]=l("label",null,"조사지명",-1)),n(a(R),{type:"text",modelValue:i.value.inquiry_name,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.inquiry_name=o),disabled:""},null,8,["modelValue"])]),l("div",ne,[e[10]||(e[10]=l("label",null,"사업명",-1)),n(a(R),{type:"text",value:i.value.business_name||"문의조사",disabled:""},null,8,["value"])]),l("div",ue,[e[11]||(e[11]=l("label",null,"작성자",-1)),n(a(R),{type:"text",modelValue:i.value.inquiry_writer,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.inquiry_writer=o),disabled:""},null,8,["modelValue"])]),l("div",ie,[e[12]||(e[12]=l("label",null,"작성일",-1)),n(a(R),{type:"text",modelValue:i.value.created_at,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.created_at=o),disabled:""},null,8,["modelValue"])])])]),_:1}),n(a(I),null,{title:v(()=>[...e[13]||(e[13]=[l("div",{class:"font-semibold text-xl"}," 조사 목적 및 내용 ",-1)])]),content:v(()=>[l("div",de,[l("div",pe,[e[14]||(e[14]=l("label",null,"대상",-1)),n(r,{modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=o=>$.value=o),options:B.value,optionLabel:"name",optionValue:"ward_no",placeholder:"대상 선택",class:"w-full md:w-56"},null,8,["modelValue","options"])]),l("div",ve,[e[15]||(e[15]=l("label",null,"목적",-1)),n(a(R),{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=o=>k.value=o),placeholder:"조사 목적을 입력하세요..."},null,8,["modelValue"])]),l("div",ce,[e[16]||(e[16]=l("label",null,"내용",-1)),n(a(h),{modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=o=>U.value=o),rows:"3",placeholder:"조사 내용을 입력하세요..."},null,8,["modelValue"])])])]),_:1}),n(a(I),null,{title:v(()=>[...e[17]||(e[17]=[l("div",{class:"font-semibold text-xl"},"질문 및 답변",-1)])]),content:v(()=>[(u(!0),p(F,null,L(O.value,(o,_)=>(u(),p("div",{key:_,class:"flex flex-col gap-6 mb-8"},[l("h3",me,D(_)+" 항목",1),(u(!0),p(F,null,L(o,(s,c)=>(u(),p("div",{key:s.id,class:"flex flex-col gap-3"},[l("label",{for:"question-"+s.id,class:"font-medium flex items-center"},[s.priority?(u(),p("span",{key:0,class:ee([{"priority-urgent":s.priority==="긴급","priority-important":s.priority==="중점","priority-plan":s.priority==="계획"},"priority-tag"])},D(s.priority),3)):w("",!0),l("span",null,"질문 "+D(c+1)+". "+D(s.text),1)],8,fe),s.response_type===1?(u(),C(a(h),{key:0,id:"question-"+s.id,modelValue:s.answer,"onUpdate:modelValue":f=>s.answer=f,rows:"4",placeholder:"답변을 입력하세요..."},null,8,["id","modelValue","onUpdate:modelValue"])):s.response_type===2?(u(),p("div",ye,[l("div",xe,[n(a(W),{inputId:"question-o-"+s.id,name:"question-"+s.id,value:"O",modelValue:s.answer,"onUpdate:modelValue":f=>s.answer=f},null,8,["inputId","name","modelValue","onUpdate:modelValue"]),l("label",{for:"question-o-"+s.id,class:"ml-2"},"O",8,_e)]),l("div",we,[n(a(W),{inputId:"question-x-"+s.id,name:"question-"+s.id,value:"X",modelValue:s.answer,"onUpdate:modelValue":f=>s.answer=f},null,8,["inputId","name","modelValue","onUpdate:modelValue"]),l("label",{for:"question-x-"+s.id,class:"ml-2"},"X",8,be)])])):w("",!0)]))),128))]))),128))]),_:1}),g.value?(u(),C(a(I),{key:0},{title:v(()=>[...e[18]||(e[18]=[l("div",{class:"font-semibold text-xl"},"수정 사유",-1)])]),content:v(()=>[l("div",ge,[n(a(h),{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=o=>V.value=o),rows:"3",placeholder:"수정 사유를 입력하세요...",class:"w-full"},null,8,["modelValue"])])]),_:1})):w("",!0),l("div",Ve,[n(a(N),{label:"목록",severity:"secondary",onClick:M}),g.value?w("",!0):(u(),C(a(N),{key:0,label:"저장",onClick:P,disabled:A.value},null,8,["disabled"])),g.value?(u(),C(a(N),{key:1,label:"수정",onClick:Q,disabled:A.value},null,8,["disabled"])):w("",!0)])])):w("",!0)])}}},Me=G(ke,[["__scopeId","data-v-d9600b92"]]);export{Me as default};
