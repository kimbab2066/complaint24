import{ax as T,aE as A,aD as O,X as r,bk as U,a1 as M,e as n,o as s,p as l,d as h,f as k,t as g,a3 as S,q as z,aJ as v,D,g as c,aF as w}from"./index-CIvZqnG9.js";import{s as L}from"./index-COnWdjRO.js";import{s as q}from"./index-V3FZzHdg.js";import{s as F}from"./index-CS-xok40.js";const J={key:0,class:"institution-state-container"},R={key:0,class:"display-section"},X={class:"status-display"},j={key:0},G={key:1},H={key:1,class:"edit-section"},K={class:"p-fluid p-formgrid p-grid"},P={class:"p-field p-col-12 p-md-6"},Q={key:0,class:"conditional-input"},W={key:1,class:"conditional-input"},Y={key:2,class:"edit-actions"},Z={key:1},ee={__name:"InstitutionState",setup(te){A();const N=O(),a=r(null),p=r(!1),_=r("");_.value=N.user.id;const b=r([{value:"1s",label:"운영"},{value:"2s",label:"휴업"},{value:"3s",label:"폐업"}]),y=o=>b.value.find(e=>e.value===o)||b.value[0],d=r(y("1s")),t=r(y("1s")),u=r(null),f=r(""),x=U(()=>t.value.value==="2s"?!u.value:t.value.value==="3s"?!f.value:!1),I=async()=>{if(_.value)try{const o=await w.get(`/api/user/institution-info/${_.value}`);a.value=o.data.result,a.value&&(a.value.status&&(d.value=y(a.value.status),t.value=d.value),a.value.closed_at&&(u.value=new Date(a.value.closed_at)))}catch(o){console.error("기관 정보를 불러오는 데 실패했습니다:",o)}};M(()=>{I()});function C(){p.value=!0}function $(){p.value=!1,t.value=d.value}async function B(){var V;const o=(V=a.value)==null?void 0:V.institution_no;if(!o){alert("기관 번호를 찾을 수 없습니다.");return}let e=null;if((t.value.value==="2s"||t.value.value==="3s")&&u.value){const m=new Date(u.value),E=m.getTimezoneOffset()*6e4;e=new Date(m.getTime()-E).toISOString().slice(0,19).replace("T"," ")}const i={status:t.value.value,closed_at:e};t.value.value==="3s"&&(i.closed_notice=f.value);try{await w.put(`/api/user/institution/${o}/status`,i),alert("기관 상태가 성공적으로 변경되었습니다."),d.value=t.value,p.value=!1,I()}catch(m){console.error("기관 상태 변경에 실패했습니다:",m),alert("기관 상태 변경 중 오류가 발생했습니다.")}}return(o,e)=>a.value?(s(),n("div",J,[e[8]||(e[8]=l("h2",{class:"section-title"},"기관 상태 관리",-1)),p.value?(s(),n("div",H,[l("div",K,[l("div",P,[e[5]||(e[5]=l("label",{for:"status-dropdown"},"상태 목록",-1)),c(v(L),{id:"status-dropdown",modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=i=>t.value=i),options:b.value,optionLabel:"label",placeholder:"상태 선택"},null,8,["modelValue","options"])])]),t.value.value==="2s"?(s(),n("div",Q,[e[6]||(e[6]=l("label",{for:"break-date"},"휴업 기간 입력",-1)),c(v(q),{id:"break-date",modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=i=>u.value=i),showIcon:""},null,8,["modelValue"])])):k("",!0),t.value.value==="3s"?(s(),n("div",W,[e[7]||(e[7]=l("label",{for:"closing-notice"},"기관 종료 공지",-1)),c(v(F),{id:"closing-notice",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=i=>f.value=i),rows:"5",placeholder:"공지 내용을 입력하세요."},null,8,["modelValue"])])):k("",!0),a.value.role==="ADMIN"?(s(),n("div",Y,[c(v(D),{label:"취소",class:"p-button-secondary",onClick:$}),c(v(D),{label:"변경하기",onClick:B,disabled:x.value},null,8,["disabled"])])):k("",!0)])):(s(),n("div",R,[l("div",X,[e[4]||(e[4]=l("i",{class:"pi pi-power-off status-icon"},null,-1)),d.value.value==="2s"?(s(),n("p",j,g(u.value?u.value.toLocaleDateString():"미정")+"까지 휴업입니다 ",1)):(s(),n("p",G,[S(" 현재 "+g(a.value.institution_name)+"은 ",1),l("span",{class:z(`status-text-${d.value.value}`)},"("+g(d.value.label)+")",3),e[3]||(e[3]=S(" 상태입니다 ",-1))]))]),a.value.role==="ADMIN"?(s(),h(v(D),{key:0,label:"기관 상태 변경하기",onClick:C})):k("",!0)]))])):(s(),n("div",Z,[...e[9]||(e[9]=[l("p",null,"기관 정보를 불러오는 중입니다...",-1)])]))}},ue=T(ee,[["__scopeId","data-v-413b0337"]]);export{ue as I};
