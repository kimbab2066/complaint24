import{ax as P,Z as E,X as v,as as X,bk as W,e as l,f as B,o,p as s,F as D,a4 as S,t as x,q as $,j as F,aH as L,bm as Z,bn as V,ay as G,a1 as K,g as O,aJ as N,ae as Q}from"./index-CIvZqnG9.js";import{s as ee}from"./index-Cq2nnSLM.js";const te={key:0,class:"fixed inset-0 z-40 flex items-center justify-center","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},se={class:"relative z-50 bg-white rounded-lg shadow-xl w-full max-w-md"},ae={class:"p-6 space-y-6"},le=["value"],oe={key:0},re={class:"mt-1 p-3 bg-gray-50 border border-gray-200 rounded-md max-h-32 overflow-y-auto space-y-2"},ne={class:"text-gray-800 font-medium"},de=["onClick"],ie=["value"],ue={__name:"StaffScheduleModal",props:{visible:Boolean,selectedDate:String,scheduledData:Object},emits:["update:visible","schedule-updated","schedule-deleted"],setup(_,{emit:M}){const r=_,n=M,g=E(),m=v("09:00"),u=v("17:00"),p=v([{label:"반복 없음",value:"none"},{label:"매주 이 요일",value:"weekly"},{label:"매일 (월-금)",value:"weekdays"}]),b=v(p.value[0].value);X(()=>r.selectedDate,i=>{i&&(m.value="09:00",u.value="17:00",b.value=p.value[0].value)});const y=W(()=>!r.selectedDate||!r.scheduledData[r.selectedDate]?[]:r.scheduledData[r.selectedDate].filter(i=>i.type==="available"));function f(){n("update:visible",!1)}async function C(i){var e,t;if(!i){console.error("삭제할 at_no가 없습니다.");return}try{await V.delete(`/api/staff/schedule/delete/${i}`),g.add({severity:"info",summary:"삭제됨",detail:"스케줄이 삭제되었습니다.",life:2e3}),n("schedule-deleted")}catch(a){console.error("스케줄 삭제 실패:",a),g.add({severity:"error",summary:"오류",detail:((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"스케줄 삭제 중 오류가 발생했습니다.",life:3e3})}}async function j(){var e,t;if(!r.selectedDate)return;const i={start_time:`${r.selectedDate}T${m.value}:00`,end_time:`${r.selectedDate}T${u.value}:00`,recurring_rules:b.value};console.log("적용할 스케줄 (API Payload):",i);try{const a=await V.post("/api/staff/schedule/create",i);g.add({severity:"success",summary:"성공",detail:a.data.message||"상담 가능 시간이 설정되었습니다.",life:3e3}),n("schedule-updated"),f()}catch(a){console.error("스케줄 설정 실패:",a),g.add({severity:"error",summary:"오류",detail:((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"스케줄 설정 중 오류가 발생했습니다.",life:3e3})}}return(i,e)=>_.visible?(o(),l("div",te,[s("div",{onClick:f,class:"absolute inset-0 bg-opacity-60 z-40"}),s("div",se,[s("div",{class:"flex justify-between items-center p-5 border-b"},[e[4]||(e[4]=s("h4",{id:"modal-title",class:"text-xl font-bold text-gray-800"},"스케줄 설정",-1)),s("button",{onClick:f,class:"text-gray-400 hover:text-gray-600"},[...e[3]||(e[3]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s("div",ae,[s("div",null,[e[5]||(e[5]=s("label",{class:"block text-sm font-medium text-gray-700"},"선택한 날짜",-1)),s("input",{type:"text",readonly:"",class:"mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md shadow-sm text-lg font-semibold text-gray-900",value:_.selectedDate},null,8,le)]),y.value.length>0?(o(),l("div",oe,[e[6]||(e[6]=s("label",{class:"block text-sm font-medium text-gray-700"},"등록된 스케줄",-1)),s("div",re,[(o(!0),l(D,null,S(y.value,(t,a)=>(o(),l("div",{key:a,class:"flex justify-between items-center text-sm p-2 bg-white rounded shadow-sm"},[s("span",ne,x(t.label),1),s("button",{onClick:c=>C(t.at_no),class:"text-red-500 hover:text-red-700 font-medium text-xs"}," 삭제 ",8,de)]))),128))])])):B("",!0),s("div",null,[s("label",{class:$(["block text-sm font-bold text-gray-800",{"border-t pt-4 mt-4":y.value.length>0}])}," 신규 스케줄 등록 ",2)]),s("div",null,[e[7]||(e[7]=s("label",{class:"block text-sm font-medium text-gray-700"},"시작 시간",-1)),F(s("input",{type:"time","onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"},null,512),[[L,m.value]])]),s("div",null,[e[8]||(e[8]=s("label",{class:"block text-sm font-medium text-gray-700"},"종료 시간",-1)),F(s("input",{type:"time","onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"},null,512),[[L,u.value]])]),s("div",null,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-gray-700"},"반복 설정",-1)),F(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"},[(o(!0),l(D,null,S(p.value,t=>(o(),l("option",{key:t.value,value:t.value},x(t.label),9,ie))),128))],512),[[Z,b.value]])])]),s("div",{class:"flex justify-end items-center p-5 bg-gray-50 border-t"},[s("button",{onClick:f,class:"px-6 py-2 mr-3 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50"}," 닫기 "),s("button",{onClick:j,class:"px-6 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700"}," 적용 ")])])])):B("",!0)}},ce=P(ue,[["__scopeId","data-v-344ca007"]]),ye={class:"p-4 md:p-8 bg-gray-100 min-h-screen"},ge={class:"max-w-7xl mx-auto"},ve={class:"mt-8 bg-white rounded-lg shadow-lg overflow-hidden"},me={class:"flex items-center justify-between px-6 py-4 border-b"},pe={class:"text-2xl font-semibold text-gray-800"},be={class:"grid grid-cols-7 gap-px bg-gray-200"},fe={key:0,class:"flex justify-center items-center",style:{"min-height":"500px"}},xe={key:1,class:"grid grid-cols-7 gap-px bg-gray-200"},he=["onClick"],we={key:0,class:"schedule-tags"},ke={__name:"StaffScheduleSettings",setup(_){const M=E(),r=v(!0),n=v(new Date),g=v(!1),m=v(""),u=G({});function p(e){if(!(e instanceof Date))return"";const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${c}`}function b(e){const t=e instanceof Date?e:new Date(e);return`${t.getFullYear()}년 ${String(t.getMonth()+1).padStart(2,"0")}월`}async function y(){var e,t;r.value=!0;try{const a=await V.get("/api/staff/schedules");Object.keys(u).forEach(c=>delete u[c]),Object.assign(u,a.data)}catch(a){console.error("스케줄 로딩 실패:",a),M.add({severity:"error",summary:"오류",detail:((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"스케줄을 불러오는 데 실패했습니다.",life:3e3})}finally{r.value=!1}}K(()=>{y()});const f=W(()=>{const e=[],t=n.value.getFullYear(),a=n.value.getMonth(),c=new Date(t,a,1),Y=new Date(t,a+1,0).getDate();let U=c.getDay();const q=new Date(t,a,0).getDate();for(let d=U;d>0;d--){const h=q-d+1;e.push({key:`prev-${h}`,day:h,classes:"calendar-day disabled-day",clickable:!1})}const A=p(new Date);for(let d=1;d<=Y;d++){const h=new Date(t,a,d),T=p(h),J=T===A,z=["calendar-day","bg-white","text-gray-900","cursor-pointer"],w=u[T],R=w?w.filter(k=>k.type==="reservation").map(k=>({label:k.label,classes:"schedule-tag tag-reservation"})):void 0;w!=null&&w.some(k=>k.type==="available")&&z.push("bg-green-50"),e.push({key:T,day:d,date:h,classes:z.join(" "),schedules:R,isToday:J,clickable:!0})}const H=(7-(U+Y)%7)%7;for(let d=1;d<=H;d++)e.push({key:`next-${d}`,day:d,classes:"calendar-day disabled-day",clickable:!1});return e});function C(){const e=n.value.getFullYear(),t=n.value.getMonth()-1;n.value=new Date(e,t,1),y()}function j(){const e=n.value.getFullYear(),t=n.value.getMonth()+1;n.value=new Date(e,t,1),y()}function i(e){m.value=p(e),g.value=!0}return(e,t)=>(o(),l("div",ye,[O(N(Q)),s("div",ge,[t[3]||(t[3]=s("h2",{class:"text-3xl font-bold text-gray-900"},"상담 스케줄 설정",-1)),t[4]||(t[4]=s("p",{class:"mt-2 text-lg text-gray-600"},"날짜를 클릭하여 상담 가능 시간을 설정하세요.",-1)),s("div",ve,[s("div",me,[s("button",{onClick:C,class:"p-2 rounded-full hover:bg-gray-100"},[...t[1]||(t[1]=[s("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),s("h3",pe,x(b(n.value)),1),s("button",{onClick:j,class:"p-2 rounded-full hover:bg-gray-100"},[...t[2]||(t[2]=[s("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])]),s("div",be,[(o(),l(D,null,S(["일","월","화","수","목","금","토"],a=>s("div",{key:a,class:"py-3 px-2 text-center text-sm font-semibold text-gray-600 bg-gray-50"},x(a),1)),64))]),r.value?(o(),l("div",fe,[O(N(ee),{style:{width:"50px",height:"50px"},strokeWidth:"8"})])):(o(),l("div",xe,[(o(!0),l(D,null,S(f.value,a=>(o(),l("div",{key:a.key,class:$(a.classes),onClick:c=>a.clickable?i(a.date):null},[s("span",{class:$(["day-number",{"today-number":a.isToday}])},x(a.day),3),a.schedules?(o(),l("div",we,[(o(!0),l(D,null,S(a.schedules,(c,I)=>(o(),l("div",{key:I,class:$(c.classes)},x(c.label),3))),128))])):B("",!0)],10,he))),128))]))])]),O(ce,{visible:g.value,selectedDate:m.value,scheduledData:u,"onUpdate:visible":t[0]||(t[0]=a=>g.value=a),onScheduleUpdated:y,onScheduleDeleted:y},null,8,["visible","selectedDate","scheduledData"])]))}},$e=P(ke,[["__scopeId","data-v-7844ce96"]]);export{$e as default};
