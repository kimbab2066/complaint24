import{ax as A,X as d,bk as N,a1 as E,aE as L,aF as B,e as i,f as D,g as o,aJ as t,w as u,p as s,D as S,aG as z,o as n,t as b,a3 as G,F as I,a4 as T,d as J,q as M}from"./index-CIvZqnG9.js";import{s as _}from"./index-CVVAIkGy.js";import{s as f}from"./index-Q5f-HasL.js";import{s as F}from"./index-DaQCVIMN.js";import{s as C}from"./index-CS-xok40.js";import{s as P}from"./index-Cq2nnSLM.js";const H={key:0,class:"flex justify-center items-center h-64"},K={key:1},W={key:2,class:"flex flex-col gap-8"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Z={class:"flex flex-col gap-3"},q={class:"flex flex-col gap-3"},ee={class:"flex flex-col gap-3"},le={class:"flex flex-col gap-3"},se={class:"flex flex-col gap-6"},ae={class:"flex flex-col gap-3"},te={class:"flex flex-col gap-3"},oe={class:"flex flex-col gap-3"},re={class:"text-lg font-bold text-gray-700 border-b pb-2"},ne=["for"],ie={key:1,class:"flex items-center gap-6"},ue={class:"flex items-center"},de=["for"],pe={class:"flex items-center"},ve=["for"],ce={class:"flex flex-col gap-3"},me={class:"flex justify-end gap-2"},fe={__name:"UserSurveyDetail",setup(ye){const R=L(),$=z(),p=d(null),m=d([]),U=d(!0),w=d(null),y=d(""),g=d(""),V=d(""),k=d(null),v=N(()=>k.value?k.value!=="검토중"&&k.value!=="1f":!1);E(async()=>{const r=R.params.survey_no;if(!r){w.value="유효하지 않은 접근입니다. 조사지 번호가 없습니다.",U.value=!1;return}try{const e=await B.get(`/api/user/survey-detail/${r}`),{surveyData:a,questionsData:c}=e.data.result;k.value=a.plan_status,p.value={inquiryName:a.inquiry_name,businessName:a.business_name,writer:a.writer,createdAt:a.created_at,wardName:a.ward_name},g.value=a.purpose||"",V.value=a.content||"",y.value=a.modify_reason||"",m.value=c.map(l=>({id:l.business_no,text:l.question_content,answer:l.survey_answer||"",response_type:l.response_type,is_required:l.is_required,priority:l.priority}))}catch(e){console.error("조사지 정보를 불러오는 데 실패했습니다:",e),w.value="조사지 정보를 불러오는 중 오류가 발생했습니다."}finally{U.value=!1}});const O=N(()=>v.value?!0:m.value.some(e=>e.is_required===1&&(e.answer===null||e.answer.toString().trim()===""))||y.value.trim()===""),Q=N(()=>!m.value||m.value.length===0?{}:m.value.reduce((r,e)=>{const a=e.priority||"기타";return r[a]||(r[a]=[]),r[a].push(e),r},{})),X=async()=>{const r=R.params.survey_no;if(!r){alert("오류: 수정할 설문 정보가 없습니다.");return}try{const a={answers:m.value.map(c=>({business_no:c.id,survey_answer:c.answer})),modificationReason:y.value,purpose:g.value,content:V.value};await B.put(`/api/user/survey-results/${r}`,a),alert("내용이 수정되었습니다."),$.push({name:"umy"})}catch(e){console.error("수정에 실패했습니다:",e),alert("수정 중 오류가 발생했습니다.")}},h=()=>{$.go(-1)};return(r,e)=>(n(),i("div",null,[U.value?(n(),i("div",H,[o(t(P))])):w.value?(n(),i("div",K,[o(t(_),null,{title:u(()=>[...e[3]||(e[3]=[G("오류",-1)])]),content:u(()=>[s("p",null,b(w.value),1),o(t(S),{label:"목록으로 돌아가기",onClick:h,class:"mt-4"})]),_:1})])):p.value?(n(),i("div",W,[o(t(_),null,{title:u(()=>[...e[4]||(e[4]=[s("div",{class:"font-semibold text-xl"},"조사지 기본 정보",-1)])]),content:u(()=>[s("div",Y,[s("div",Z,[e[5]||(e[5]=s("label",null,"조사지명",-1)),o(t(f),{type:"text",value:p.value.inquiryName,disabled:""},null,8,["value"])]),s("div",q,[e[6]||(e[6]=s("label",null,"사업명",-1)),o(t(f),{type:"text",value:p.value.businessName,disabled:""},null,8,["value"])]),s("div",ee,[e[7]||(e[7]=s("label",null,"작성자",-1)),o(t(f),{type:"text",value:p.value.writer,disabled:""},null,8,["value"])]),s("div",le,[e[8]||(e[8]=s("label",null,"작성일",-1)),o(t(f),{type:"text",value:p.value.createdAt,disabled:""},null,8,["value"])])])]),_:1}),o(t(_),null,{title:u(()=>[...e[9]||(e[9]=[s("div",{class:"font-semibold text-xl"},"조사 목적 및 내용",-1)])]),content:u(()=>[s("div",se,[s("div",ae,[e[10]||(e[10]=s("label",null,"대상자",-1)),o(t(f),{type:"text",value:p.value.wardName,disabled:""},null,8,["value"])]),s("div",te,[e[11]||(e[11]=s("label",null,"목적",-1)),o(t(f),{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),placeholder:"조사 목적을 입력하세요...",disabled:v.value},null,8,["modelValue","disabled"])]),s("div",oe,[e[12]||(e[12]=s("label",null,"내용",-1)),o(t(C),{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=a=>V.value=a),rows:"3",placeholder:"조사 내용을 입력하세요...",disabled:v.value},null,8,["modelValue","disabled"])])])]),_:1}),o(t(_),null,{title:u(()=>[...e[13]||(e[13]=[s("div",{class:"font-semibold text-xl"},"질문 및 답변",-1)])]),content:u(()=>[(n(!0),i(I,null,T(Q.value,(a,c)=>(n(),i("div",{key:c,class:"flex flex-col gap-6 mb-8"},[s("h3",re,b(c)+" 항목",1),(n(!0),i(I,null,T(a,(l,j)=>(n(),i("div",{key:l.id,class:"flex flex-col gap-3"},[s("label",{for:"question-"+l.id,class:"font-medium flex items-center"},[l.priority?(n(),i("span",{key:0,class:M([{"priority-urgent":l.priority==="긴급","priority-important":l.priority==="중점","priority-plan":l.priority==="계획"},"priority-tag"])},b(l.priority),3)):D("",!0),s("span",null,"질문 "+b(j+1)+". "+b(l.text),1)],8,ne),l.response_type===1?(n(),J(t(C),{key:0,id:"question-"+l.id,modelValue:l.answer,"onUpdate:modelValue":x=>l.answer=x,rows:"4",placeholder:"답변을 입력하세요...",disabled:v.value},null,8,["id","modelValue","onUpdate:modelValue","disabled"])):l.response_type===2?(n(),i("div",ie,[s("div",ue,[o(t(F),{inputId:"question-o-"+l.id,name:"question-"+l.id,value:"O",modelValue:l.answer,"onUpdate:modelValue":x=>l.answer=x,disabled:v.value},null,8,["inputId","name","modelValue","onUpdate:modelValue","disabled"]),s("label",{for:"question-o-"+l.id,class:"ml-2"},"O",8,de)]),s("div",pe,[o(t(F),{inputId:"question-x-"+l.id,name:"question-"+l.id,value:"X",modelValue:l.answer,"onUpdate:modelValue":x=>l.answer=x,disabled:v.value},null,8,["inputId","name","modelValue","onUpdate:modelValue","disabled"]),s("label",{for:"question-x-"+l.id,class:"ml-2"},"X",8,ve)])])):D("",!0)]))),128))]))),128))]),_:1}),o(t(_),null,{title:u(()=>[...e[14]||(e[14]=[s("div",{class:"font-semibold text-xl"},"수정 사유",-1)])]),content:u(()=>[s("div",ce,[o(t(C),{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),rows:"3",placeholder:"수정 사유를 입력하세요...",class:"w-full",disabled:v.value},null,8,["modelValue","disabled"])])]),_:1}),s("div",me,[o(t(S),{label:"목록",severity:"secondary",onClick:h}),o(t(S),{label:"수정",onClick:X,disabled:O.value},null,8,["disabled"])])])):D("",!0)]))}},ke=A(fe,[["__scopeId","data-v-c6aeffb1"]]);export{ke as default};
